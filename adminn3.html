<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DATA PENDAFTAR - SIAP CETAK</title>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
    /* TAMPILAN LAYAR (WEB) */
    body { font-family: sans-serif; background: #f4f4f4; padding: 20px; color: #333; }
    
    .toolbar {
        background: #2c3e50; padding: 15px; border-radius: 8px; color: white;
        display: flex; justify-content: space-between; align-items: center;
        margin-bottom: 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    .btn-print {
        background: #e74c3c; color: white; border: none; padding: 10px 20px;
        font-weight: bold; border-radius: 5px; cursor: pointer; font-size: 14px;
    }
    .btn-print:hover { background: #c0392b; }

    /* KARTU DATA */
    .card {
        background: #fff; padding: 25px; margin-bottom: 20px;
        border: 1px solid #ddd; border-radius: 8px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        page-break-inside: avoid; /* Agar kartu tidak terpotong saat diprint */
    }

    .header-card {
        border-bottom: 2px solid #2c3e50; padding-bottom: 10px; margin-bottom: 15px;
        display: flex; justify-content: space-between; align-items: center;
    }
    .nama { font-size: 20px; font-weight: bold; color: #2c3e50; text-transform: uppercase; }
    .waktu { font-size: 12px; color: #666; }

    .grid-info {
        display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 20px;
    }
    .row { border-bottom: 1px solid #eee; padding-bottom: 5px; }
    .lbl { font-size: 11px; font-weight: bold; color: #7f8c8d; display: block; }
    .val { font-size: 14px; color: #2c3e50; font-weight: 500; }

    /* GALERI FOTO */
    .gallery {
        display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-top: 10px;
    }
    .img-box { text-align: center; border: 1px solid #eee; padding: 5px; border-radius: 5px; }
    .img-box img {
        width: 100%; height: 120px; object-fit: contain; /* Agar gambar tidak gepeng */
        display: block; margin-bottom: 5px; background: #fafafa;
    }
    .img-lbl { font-size: 11px; font-weight: bold; display: block; margin-top: 5px; }

    /* =========================================
       MODE CETAK (PRINT CSS)
       Bagian ini yang membuat hasil print jadi PDF Rapi
       ========================================= */
    @media print {
        body { background: white; padding: 0; margin: 0; -webkit-print-color-adjust: exact; }
        .toolbar { display: none; } /* Sembunyikan tombol saat diprint */
        .card { 
            border: 1px solid #000; box-shadow: none; margin-bottom: 30px; 
            break-inside: avoid; /* Wajib: Mencegah data terpotong antar halaman */
        }
        .img-box img { height: 150px; object-fit: contain; }
        .gallery { grid-template-columns: repeat(3, 1fr); gap: 10px; }
        
        /* Paksa background warna tetap muncul */
        * { -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; }
    }
</style>
</head>
<body>

<div class="toolbar">
    <div>
        <strong>ADMIN PANEL</strong><br>
        <span style="font-size:12px">Total Data: <span id="totalData">0</span></span>
    </div>
    <button class="btn-print" onclick="window.print()">üñ®Ô∏è DOWNLOAD PDF / PRINT</button>
</div>

<div id="container">Sedang memuat data dari database...</div>

<script>
// === CONFIG FIREBASE (SAMA SEPERTI YANG DI FORMULIR) ===
const firebaseConfig = {
  apiKey: "AIzaSyD-4D5ZC4RYcmcpRyxxScLBo1oqC-oRdYw",
  authDomain: "sewamilikmolis-e3427.firebaseapp.com",
  projectId: "sewamilikmolis-e3427",
  storageBucket: "sewamilikmolis-e3427.firebasestorage.app",
  messagingSenderId: "934998664118",
  appId: "1:934998664118:web:602d8ef8053099aa329717"
};

if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

const container = document.getElementById('container');
const totalLabel = document.getElementById('totalData');

// AMBIL DATA REALTIME
db.collection("pendaftaran_hemat")
  .orderBy("waktu", "desc")
  .onSnapshot((snapshot) => {
    container.innerHTML = "";
    totalLabel.innerText = snapshot.size;

    if(snapshot.empty){
        container.innerHTML = "<p style='text-align:center; padding:20px;'>Belum ada data masuk.</p>";
        return;
    }

    snapshot.forEach((doc) => {
        const d = doc.data();
        
        // Template HTML untuk setiap Driver
        const html = `
        <div class="card">
            <div class="header-card">
                <div>
                    <div class="nama">${d.nama || '-'}</div>
                    <div class="waktu">Terdaftar: ${d.waktu}</div>
                </div>
                <div style="text-align:right">
                    <span style="background:#eee; padding:5px 10px; border-radius:4px; font-size:12px; font-weight:bold">
                        Referral: ${d.referral}
                    </span>
                </div>
            </div>

            <div class="grid-info">
                <div class="row"><span class="lbl">No WhatsApp</span><span class="val">${d.wa}</span></div>
                <div class="row"><span class="lbl">Status Nikah</span><span class="val">${d.status}</span></div>
                <div class="row"><span class="lbl">Tempat, Tgl Lahir</span><span class="val">${d.ttl}</span></div>
                <div class="row"><span class="lbl">Email</span><span class="val">${d.email}</span></div>
                <div class="row"><span class="lbl">Alamat KTP</span><span class="val">${d.alamatKtp}</span></div>
                <div class="row"><span class="lbl">Alamat Domisili</span><span class="val">${d.alamatDomisili}</span></div>
                <div class="row"><span class="lbl">Kontak Darurat</span><span class="val">${d.darurat}</span></div>
                <div class="row"><span class="lbl">Lokasi Maps</span><span class="val" style="font-size:10px">${d.maps}</span></div>
            </div>

            <div style="border-top:2px dashed #eee; margin:15px 0;"></div>
            <div style="font-weight:bold; margin-bottom:10px; font-size:12px; text-align:center;">LAMPIRAN DOKUMEN</div>

            <div class="gallery">
                ${renderImg(d.ktp, 'KTP ASLI')}
                ${renderImg(d.sim, 'SIM C')}
                ${renderImg(d.kk, 'KARTU KELUARGA')}
                ${renderImg(d.selfie, 'FOTO SELFIE')}
                ${renderImg(d.ojol, 'PROFIL OJOL')}
                ${renderImg(d.gaji1, 'SLIP GAJI 1')}
            </div>
        </div>
        `;
        container.insertAdjacentHTML('beforeend', html);
    });
});

function renderImg(base64, label){
    // Jika tidak ada foto, tampilkan kotak kosong bertuliskan "Tidak ada"
    if(!base64) return `
        <div class="img-box" style="background:#eee; display:flex; align-items:center; justify-content:center; color:#999; font-size:10px; height:120px;">
            ${label} (Kosong)
        </div>`;
        
    return `
    <div class="img-box">
        <img src="${base64}">
        <span class="img-lbl">${label}</span>
    </div>`;
}
</script>

</body>
</html>
