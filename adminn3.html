<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ADMIN PANEL (LOCAL)</title>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<style>
    body { font-family: 'Inter', sans-serif; background: #f1f5f9; padding: 20px; color: #334155; }
    
    .navbar { 
        background: #fff; padding: 15px 25px; border-radius: 12px; margin-bottom: 25px; 
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); display: flex; justify-content: space-between; align-items: center;
    }
    
    .card { 
        background: #fff; border-radius: 12px; padding: 20px; margin-bottom: 15px; 
        box-shadow: 0 2px 4px rgba(0,0,0,0.05); display: flex; flex-wrap: wrap; gap: 15px; justify-content: space-between; align-items: center;
        border-left: 5px solid #cbd5e1; transition: 0.3s;
    }
    .card.done { border-left-color: #22c55e; background: #f0fdf4; } /* Warna Hijau kalau sudah dikirim */

    .info { flex: 1; min-width: 250px; }
    .info h3 { margin: 0 0 5px 0; font-size: 16px; color: #1e293b; }
    .date { font-size: 12px; color: #64748b; display: flex; gap: 10px; align-items: center; }

    .actions { display: flex; gap: 10px; align-items: center; }
    
    /* BADGE STATUS */
    .status-badge {
        font-size: 11px; padding: 5px 10px; border-radius: 20px; font-weight: bold; cursor: pointer;
        background: #e2e8f0; color: #64748b; border: 1px solid #cbd5e1;
    }
    .status-badge.sent { background: #dcfce7; color: #166534; border-color: #86efac; }

    /* TOMBOL SHARE */
    .btn-share {
        background: #2563eb; color: white; border: none; padding: 8px 15px;
        border-radius: 8px; font-weight: 600; cursor: pointer; font-size: 13px;
        display: flex; align-items: center; gap: 5px;
    }
    .btn-share:hover { background: #1d4ed8; }

</style>
</head>
<body>

<div class="navbar">
    <b>ADMIN PANEL (CONTROL)</b>
    <span style="font-size:12px">Total Data: <span id="total">0</span></span>
</div>

<div id="container">Memuat data...</div>

<script>
// CONFIG FIREBASE (Sama seperti form)
const firebaseConfig = {
  apiKey: "AIzaSyD-4D5ZC4RYcmcpRyxxScLBo1oqC-oRdYw",
  authDomain: "sewamilikmolis-e3427.firebaseapp.com",
  projectId: "sewamilikmolis-e3427",
  storageBucket: "sewamilikmolis-e3427.firebasestorage.app",
  messagingSenderId: "934998664118",
  appId: "1:934998664118:web:602d8ef8053099aa329717"
};

if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// GANTI URL INI DENGAN LINK GITHUB KAMU NANTI
// Contoh: https://username.github.io/detail.html
const BASE_URL_DETAIL = window.location.href.replace('admin.html', 'detail.html');

db.collection("pendaftaran_v3").orderBy("timestamp", "desc").onSnapshot(snap => {
    const div = document.getElementById('container');
    document.getElementById('total').innerText = snap.size;
    div.innerHTML = "";

    if(snap.empty) { div.innerHTML = "<p style='text-align:center'>Belum ada data.</p>"; return; }

    snap.forEach(doc => {
        const d = doc.data();
        const id = doc.id;
        const isSent = d.status_pusat === true; // Cek status apakah sudah dikirim
        
        div.innerHTML += `
        <div class="card ${isSent ? 'done' : ''}">
            <div class="info">
                <h3>${d.nama}</h3>
                <div class="date">
                    <span>üìÖ ${d.waktu}</span>
                    <span>‚Ä¢ Ref: <b>${d.referral}</b></span>
                </div>
                <div style="font-size:12px; margin-top:5px; color:#475569">WA: ${d.wa}</div>
            </div>

            <div class="actions">
                <div class="status-badge ${isSent ? 'sent' : ''}" onclick="toggleStatus('${id}', ${!isSent})">
                    ${isSent ? '‚úÖ SUDAH DIKIRIM' : '‚è≥ BELUM DIKIRIM'}
                </div>

                <button class="btn-share" onclick="shareToPusat('${id}', '${d.nama}')">
                    üöÄ Kirim ke Pusat
                </button>
            </div>
        </div>`;
    });
});

// FUNGSI UBAH STATUS
function toggleStatus(id, newStatus) {
    db.collection("pendaftaran_v3").doc(id).update({
        status_pusat: newStatus
    });
}

// FUNGSI SHARE KE WA
function shareToPusat(id, nama) {
    // 1. Update status jadi dikirim dulu
    toggleStatus(id, true);

    // 2. Buat Link Khusus
    const link = `${BASE_URL_DETAIL}?uid=${id}`;
    
    // 3. Buat Teks WA
    const text = `*DATA DRIVER BARU*\n\nNama: ${nama}\nLink Data: ${link}\n\nMohon segera diproses.`;
    
    // 4. Buka WA
    window.open(`https://wa.me/?text=${encodeURIComponent(text)}`, '_blank');
}
</script>
</body>
</html>
