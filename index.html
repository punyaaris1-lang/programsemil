<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TES DIAGNOSA ERROR</title>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-storage.js"></script>
<style>
    body{font-family:sans-serif;padding:20px;text-align:center}
    button{padding:15px 30px;background:red;color:white;border:none;font-size:18px;border-radius:5px;margin-top:20px}
    #status{margin-top:20px;font-weight:bold;color:blue}
</style>
</head>
<body>

    <h2>TES UPLOAD SATU FILE</h2>
    <p>Pilih file kecil saja untuk tes:</p>
    <input type="file" id="fileInput">
    <br>
    <button onclick="uploadTes()">UPLOAD SEKARANG</button>
    <div id="status">Menunggu...</div>

<script>
    // --- KONFIGURASI SAYA UBAH PAKAI 'appspot.com' (LEBIH STABIL DI HP) ---
    const firebaseConfig = {
      apiKey: "AIzaSyCvgr6tqDSX0BRKxRAf3ylxFQkOtaeBGsI",
      projectId: "semil-d907b",
      storageBucket: "semil-d907b.appspot.com", // <-- SAYA GANTI INI
      appId: "1:1014876558020:web:ecf05933a7b2e852b2ef91"
    };

    if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
    const storage = firebase.storage();

    function uploadTes() {
        const file = document.getElementById('fileInput').files[0];
        const status = document.getElementById('status');

        if (!file) { alert("Pilih file dulu!"); return; }

        status.innerText = "Mencoba Upload...";
        
        // Nama file acak biar gak bentrok
        const namaFile = "tes_" + Date.now() + ".jpg";
        const ref = storage.ref(namaFile);

        const task = ref.put(file);

        task.on('state_changed', 
            (snapshot) => {
                var progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                status.innerText = "Progress: " + Math.floor(progress) + "%";
            }, 
            (error) => {
                // --- INI BAGIAN PENTINGNYA ---
                console.error(error);
                let pesan = "ERROR: " + error.code + "\n" + error.message;
                
                if(error.code === 'storage/unauthorized') {
                    pesan = "GAGAL: IZIN DITOLAK (RULES FIREBASE MASIH SALAH)\nCek Tab Rules di Console!";
                } else if(error.code === 'storage/object-not-found' || error.code === 'storage/bucket-not-found') {
                    pesan = "GAGAL: BUCKET TIDAK DITEMUKAN\nNama storageBucket salah.";
                } else if(error.code === 'storage/retry-limit-exceeded') {
                    pesan = "GAGAL: KONEKSI LEMAH";
                }

                alert(pesan); // MUNCULKAN POPUP
                status.innerText = "GAGAL TOTAL";
                status.style.color = "red";
            }, 
            () => {
                alert("BERHASIL! Masalah selesai. Config 'appspot.com' adalah kuncinya.");
                status.innerText = "SUKSES TERUPLOAD!";
                status.style.color = "green";
            }
        );
    }
</script>
</body>
</html>
